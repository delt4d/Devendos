@inherits LayoutComponentBase
@inject NavigationManager NavManager

<MudThemeProvider />
<MudSnackbarProvider />
<MudPopoverProvider />
<MudDialogProvider
    Position="DialogPosition.Center"
    FullWidth="false"
    CloseButton="false"
    BackdropClick="false"
    CloseOnEscapeKey="true"/>

<MudLayout Class="d-flex flex-column" Style="height: 100vh;">
    <MudMainContent Class="flex-grow-1 flex-shrink-1 overflow-y-auto">
        <MudContainer MaxWidth="MaxWidth.Medium" Class="pb-4">
            @Body
        </MudContainer>
    </MudMainContent>

    <MudTabs Centered="true" @bind-ActivePanelIndex="_currentTab" MinimumTabWidth="122px">
        <MudTabPanel 
            Text="Home"
            OnClick="() => NavManager.NavigateTo(HomeRoute)"
        />
        
        <MudTabPanel 
            Text="Contatos" 
            OnClick="() => NavManager.NavigateTo(ContactsRoute)"
        />
        
        <MudTabPanel 
            Text="Lembretes" 
            OnClick="() => NavManager.NavigateTo(RemindersRoute)"
        />
    </MudTabs>
</MudLayout>

@code {
    private const string HomeRoute = "/home";
    private const string ContactsRoute = "/contacts";
    private const string RemindersRoute = "/reminders";
    
    private static int _currentTab = 0;
    
    protected override void OnInitialized()
    {
        NavManager.RegisterLocationChangingHandler((ctx) =>
        {
            var location = ctx.TargetLocation;
            
            if (location.Contains("/home"))
                _currentTab = 0;
            else if (location.Contains("/contacts"))
                _currentTab = 1;
            else if (location.Contains("/reminders"))
                _currentTab = 2;
            
            return ValueTask.CompletedTask;
        });
    }
}